<div
  class="w-full overflow-hidden rounded-xl shadow-md"
  [ngClass]="{ 'ring-1 ring-blue-200': headerCssClass !== 'header-primary' }"
>
  <!-- Contenedor scrollable -->
  <div class="max-h-[30rem] overflow-auto">
    <table
      class="w-full"
      cdk-table
      aria-describedby="table"
      [dataSource]="data || []"
    >
      <ng-container cdkColumnDef="select">
        <th
          cdk-header-cell
          *cdkHeaderCellDef
          class="bg-gradient-to-r from-blue-600 to-cyan-600 text-white p-2 sticky top-0 z-10"
        >
          <mat-checkbox
            type="checkbox"
            [checked]="isAllSelected()"
            (change)="toggleSelectAll()"
            class="accent-white"
          ></mat-checkbox>
        </th>
        <td
          cdk-cell
          *cdkCellDef="let element"
          class="p-2 border-b border-gray-100 bg-white"
        >
          <mat-checkbox
            type="checkbox"
            [checked]="isSelected(element)"
            (change)="toggleSelection(element)"
            class="accent-blue-500"
          ></mat-checkbox>
        </td>
      </ng-container>

      <ng-container
        *ngFor="let column of displayedColumns"
        [cdkColumnDef]="column"
      >
        <th
          cdk-header-cell
          *cdkHeaderCellDef
          [ngClass]="headerCssClass"
          class="bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-bold uppercase text-xs p-4 sticky top-0 z-10"
        >
          {{ column | translation | camelToTitle }}
        </th>
        <td
          cdk-cell
          *cdkCellDef="let element"
          class="pl-4 p-1 border-b border-gray-100 hover:bg-blue-50 transition-colors"
        >
          @if (column.includes(".")) {
          <span
            class="{{ column === 'userInfo.name' ? 'font-bold text-gray-800 text-base' : 'text-gray-700' }}"
          >
            {{ resolveNestedProperty(element, column) }}
          </span>
          } @if (column === "type") {
          <app-badge
            [colorBadge]="
                element[column] === 'room'
                  ? EColorBadge.SUCCESS
                  : EColorBadge.ERROR
              "
            [textBadge]="element[column] === 'room' ? 'Sala' : (element[column] === 'mixed' ? 'Mixto' : 'N/A')"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "category") {
          <app-badge
            [colorBadge]="getColorBadge(element[column])"
            [textBadge]="getTextBadge(element[column])"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "name") {
          <span class="font-bold text-gray-800 text-base"
            >{{ element[column] }}</span
          >
          } @if (column === "isCustom") {
          <app-badge
            [colorBadge]="
                element[column] ? EColorBadge.SUCCESS : EColorBadge.WARNING
              "
            [textBadge]="element[column] ? 'Personalizado' : 'Predeterminado'"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "sexType") {
          <app-badge
            [colorBadge]="getSexTypeBadgeColor(element[column])"
            [textBadge]="getSexTypeLabel(element[column])"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "successful") {
          <app-badge
            [colorBadge]="element[column] ? EColorBadge.SUCCESS : EColorBadge.ERROR"
            [textBadge]="element[column] ? 'Exitoso' : 'Fallido'"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "accessDate") {
          <span class="text-gray-700">{{ element[column] | utcDate }}</span>
          } @if (column === "cedula") {
          <span class="text-gray-700 font-mono"
            >{{ formatCedula(element[column]) }}</span
          >
          } @if (column === "image") {
          <div class="image-container flex justify-center">
            @if (element.rewardImageUrl || element.imageUrl) {
            <img
              [src]="element.rewardImageUrl || element.imageUrl"
              [alt]="element.rewardName || element.name || 'Imagen'"
              class="w-12 h-12 object-cover rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow"
              loading="lazy"
              decoding="async"
              (error)="handleImageError($event)"
            />
            } @else {
            <div
              class="w-12 h-12 bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg border border-gray-300 flex items-center justify-center shadow-sm"
            >
              <mat-icon class="text-gray-500" style="font-size: 20px"
                >image</mat-icon
              >
            </div>
            }
          </div>
          } @if (column === "imageUrl") {
          <div class="image-container flex justify-center">
            <img
              [src]="getImageUrl(element[column])"
              [alt]="element.name || 'Premio'"
              class="w-12 h-12 object-cover rounded-lg border border-gray-200"
              loading="lazy"
              decoding="async"
              (error)="handleImageError($event)"
            />
          </div>
          } @if (column === "pointsRequired") {
          <app-badge
            [colorBadge]="EColorBadge.INFO"
            [textBadge]="element[column] + ' pts'"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "totalExchanges") {
          <app-badge
            [colorBadge]="element[column] > 0 ? EColorBadge.SUCCESS : EColorBadge.NEUTRAL"
            [textBadge]="(element[column] ?? 0).toString()"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "enabled" || column === "disabled") {
          <app-badge
            [colorBadge]="(column === 'disabled' ? !element[column] : element[column]) ? EColorBadge.SUCCESS : EColorBadge.ERROR"
            [textBadge]="(column === 'disabled' ? !element[column] : element[column]) ? 'Habilitado' : 'Deshabilitado'"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "lastAccess") {
          <span class="text-gray-700"
            >{{ element[column] ? (element[column] | date: 'd/MM/y, h:mm a') :
            'Sin acceso' }}</span
          >
          } @if (column === "totalAccesses") {
          <app-badge
            [colorBadge]="getTotalAccessesBadgeColor(element[column])"
            [textBadge]="(element[column] || 0) + ' accesos'"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "date") {
          <span class="font-medium text-gray-900"
            >{{ formatExchangeDate(element.exchangeDate || element.createdAt)
            }}</span
          >
          } @if (column === "client") {
          <div class="flex flex-col space-y-1">
            <span class="font-medium text-gray-900"
              >{{ element.clientName }}</span
            >
            <span class="text-sm text-gray-500">{{ element.clientEmail }}</span>
          </div>
          } @if (column === "reward") {
          <div class="flex flex-col space-y-1">
            <span class="font-medium text-gray-900 truncate"
              >{{ element.rewardName }}</span
            >
            <span
              class="text-sm text-gray-500 line-clamp-2"
              *ngIf="element.rewardDescription"
            >
              {{ element.rewardDescription }}
            </span>
          </div>
          } @if (column === "pointsUsed") {
          <app-badge
            [colorBadge]="EColorBadge.INFO"
            [textBadge]="element[column] + ' pts'"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "reason") {
          <app-badge
            [colorBadge]="getReasonBadgeColor(element[column])"
            [textBadge]="element[column]"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "status" && (element.status === 'COMPLETED' ||
          element.status === 'PENDING')) {
          <app-badge
            [colorBadge]="getNotificationStatusBadgeColor(element[column])"
            [textBadge]="getNotificationStatusText(element[column])"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "status" && (element.status === 'completed' ||
          element.status === 'pending' || element.status === 'cancelled')) {
          <app-badge
            [colorBadge]="getExchangeStatusBadgeColor(element[column])"
            [textBadge]="getExchangeStatusText(element[column])"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "estadoPago") {
          <app-badge
            [colorBadge]="getPaymentStatusBadgeColor(element)"
            [textBadge]="getPaymentStatusText(element)"
            class="transform hover:scale-105 transition-transform"
          ></app-badge>
          } @if (column === "amount") {
          <span class="text-sm font-bold text-green-600">
            {{ formatCurrency(element[column]) }}
          </span>
          } @if ( column !== "isActive" && column !== "type" && column !==
          "createdAt" && column !== "updatedAt" && column !== "name" && column
          !== "isCustom" && column !== "category" && column !== "sexType" && column !== "successful" && column !== "accessDate" && column !== "cedula" && column !== "lastAccess" && column !== "totalAccesses" && column !== "estadoPago" && column !== "imageUrl" && column !== "pointsRequired" && column !== "totalExchanges" && column !== "enabled" && column !== "disabled" && column !== "date" && column !== "client" && column !== "reward" && column !== "pointsUsed" && column !== "status" && column !== "image" && column !== "amount" && column !== "reason" ) {
          <span class="text-gray-700">{{ element[column] }}</span>
          }
          <ng-container
            *ngIf="column === 'createdAt' || column === 'updatedAt'"
          >
            <span class="text-gray-500 text-sm"
              >{{ element[column] | date: "d MMM y, h:mm a" }}</span
            >
          </ng-container>

          <ng-container *ngIf="column === 'acciones'">
            <button
              title="actions"
              type="button"
              [matMenuTriggerFor]="actionsMenu"
              class="text-gray-600 hover:text-blue-600 transition-colors rounded-full p-2 hover:bg-blue-50"
            >
              <i class="ph-dots-three-vertical-fill text-2xl"></i>
            </button>
            <mat-menu #actionsMenu="matMenu" class="bg-gray-800">
              <ng-template matMenuContent>
                @if (showSeeDetail) {
                <button
                  (click)="emitSeeDetail(element.clientId ? element.clientId : element.id || element._id || element.cedula)"
                  type="button"
                  class="group"
                  mat-menu-item
                >
                  <div class="flex flex-row items-center space-x-2">
                    <i class="ph-eye text-cyan-600 text-button-lg"></i>
                    <span
                      class="text-gray-700 group-hover:text-cyan-600 transition-colors"
                      >Ver Detalle</span
                    >
                  </div>
                </button>
                }
                @if (showEdit) {
                <button
                  (click)="emitEdit(element.id || element._id || element.cedula)"
                  type="button"
                  class="group"
                  mat-menu-item
                >
                  <div class="flex flex-row items-center space-x-2">
                    <i
                      class="ph-pencil-simple text-blue-600 text-button-lg"
                    ></i>
                    <span
                      class="text-gray-700 group-hover:text-blue-600 transition-colors"
                      >Editar</span
                    >
                  </div>
                </button>
                }
                @if (showAddPayment) {
                <button
                  (click)="emitAddPayment(element)"
                  type="button"
                  class="group"
                  mat-menu-item
                >
                  <div class="flex flex-row items-center space-x-2">
                    <i
                      class="ph-currency-dollar text-button-lg text-green-600 group-hover:text-green-700"
                    ></i>
                    <span class="text-green-600 group-hover:text-green-700"
                      >Agregar Pago</span
                    >
                  </div>
                </button>
                }
                 @if (showDisabled) {
                <button
                  (click)="emitDisabled(element.id || element._id, element.disabled)"
                  type="button"
                  class="group"
                  mat-menu-item
                >
                  <div class="flex flex-row items-center space-x-2">
                    <i
                      [class]="element.disabled 
                        ? 'ph-check-circle-fill text-button-lg text-green-500 group-hover:text-green-600' 
                        : 'ph-x-circle-fill text-button-lg text-red-500 group-hover:text-red-600'"
                    ></i>
                    <span
                      [class]="element.disabled 
                        ? 'text-green-500 group-hover:text-green-600' 
                        : 'text-red-500 group-hover:text-red-600'"
                      >{{ element.disabled ? "Habilitar" : "Deshabilitar"
                      }}</span
                    >
                  </div>
                </button>
                }
                @if (showDelete) {
                <button
                  (click)="emitDelete(element)"
                  type="button"
                  class="group"
                  mat-menu-item
                >
                  <div class="flex flex-row items-center space-x-2">
                    <i
                      class="ph-x-circle-fill text-button-lg text-red-500 group-hover:text-red-600"
                    ></i>
                    <span class="text-red-500 group-hover:text-red-600"
                      >Borrar</span
                    >
                  </div>
                </button>
                }
              </ng-template>
            </mat-menu>
          </ng-container>
        </td>
      </ng-container>

      <tr
        cdk-header-row
        *cdkHeaderRowDef="tableColumns"
        class="border-b border-gray-200"
      ></tr>
      <tr
        cdk-row
        *cdkRowDef="let row; columns: tableColumns"
        class="hover:bg-gray-50 hover:bg-opacity-70 transition-colors"
      ></tr>
      <tr class="mat-row" *matNoDataRow>
        <td
          class="mat-cell h-[30vh] bg-gray-50"
          [attr.colspan]="displayedColumns.length + 1"
        >
          <ng-container *ngIf="loading">
            <app-loader [text]="'Cargando...'"></app-loader>
          </ng-container>
          <ng-container *ngIf="!loading && total === 0 && filteredData">
            <div
              class="flex flex-col text-center justify-center items-center space-y-4 text-gray-600 p-10"
            >
              <i class="ph-magnifying-glass text-6xl text-gray-400 mb-2"></i>
              <span>No se encontraron resultados.</span>
            </div>
          </ng-container>
          <ng-container *ngIf="!loading && total === 0 && !filteredData">
            <div
              class="flex flex-col text-center justify-center items-center space-y-4 text-gray-600 p-10"
            >
              <i class="ph-clipboard-text text-6xl text-gray-400 mb-2"></i>
              <span>No hay elementos para mostrar ðŸ’ª Â¡AÃ±ade uno nuevo!</span>
            </div>
          </ng-container>
        </td>
      </tr>
    </table>
  </div>
  <ng-content></ng-content>
</div>
