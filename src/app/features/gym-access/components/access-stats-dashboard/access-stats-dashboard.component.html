<!-- Loading State -->
<div *ngIf="loading" class="flex justify-center items-center py-12">
  <app-loader></app-loader>
</div>

<!-- Dashboard Content -->
<div *ngIf="!loading && hasStatsData()" class="space-y-6">
  
  <!-- Stats Cards Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <div
      *ngFor="let card of statCards"
      class="bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow duration-200">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <p class="text-sm font-medium text-gray-600 mb-1">{{ card.title }}</p>
          <p class="text-2xl font-bold text-gray-900">{{ card.value }}</p>
          
          <!-- Trend indicator (if available) -->
          <div *ngIf="card.trend" class="flex items-center mt-2">
            <mat-icon 
              class="text-sm mr-1"
              [ngClass]="card.trend.direction === 'up' ? 'text-green-500' : 'text-red-500'">
              {{ card.trend.direction === 'up' ? 'arrow_upward' : 'arrow_downward' }}
            </mat-icon>
            <span 
              class="text-sm font-medium"
              [ngClass]="card.trend.direction === 'up' ? 'text-green-600' : 'text-red-600'">
              {{ card.trend.value }}%
            </span>
            <span class="text-sm text-gray-500 ml-1">{{ card.trend.period }}</span>
          </div>
        </div>
        
        <!-- Icon -->
        <div [ngClass]="getStatCardColorClass(card.color)" class="p-3 rounded-full">
          <mat-icon>{{ card.icon }}</mat-icon>
        </div>
      </div>
    </div>
  </div>

  <!-- Access Summary -->
  <div class="bg-white rounded-lg border border-gray-200 p-6" *ngIf="stats">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-gray-900">Resumen de Accesos Hoy</h3>
      <mat-icon class="text-gray-400">analytics</mat-icon>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="text-center p-4 bg-green-50 rounded-lg">
        <p class="text-sm text-gray-600">Accesos Exitosos</p>
        <p class="text-xl font-bold text-green-600">{{ formatNumber(stats.overview.totalAccessesToday - stats.overview.failedAccessesToday) }}</p>
      </div>
      <div class="text-center p-4 bg-red-50 rounded-lg">
        <p class="text-sm text-gray-600">Accesos Fallidos</p>
        <p class="text-xl font-bold text-red-600">{{ formatNumber(stats.overview.failedAccessesToday) }}</p>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    
    <!-- Daily Access Trends Chart -->
    <div class="bg-white rounded-lg border border-gray-200 p-6" *ngIf="hasChartData('dailyAccesses')">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Tendencia de Accesos Diarios</h3>
      <div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
        <div class="text-center">
          <mat-icon class="text-gray-400 text-4xl mb-2">bar_chart</mat-icon>
          <p class="text-gray-600">Gráfico de accesos diarios</p>
          <p class="text-sm text-gray-500">Se mostraría aquí con una librería de gráficos</p>
        </div>
      </div>
    </div>

    <!-- Popular Times Chart -->
    <div class="bg-white rounded-lg border border-gray-200 p-6" *ngIf="hasChartData('popularTimes')">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Horarios Más Populares</h3>
      <div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
        <div class="text-center">
          <mat-icon class="text-gray-400 text-4xl mb-2">schedule</mat-icon>
          <p class="text-gray-600">Gráfico de horarios populares</p>
          <p class="text-sm text-gray-500">Se mostraría aquí con una librería de gráficos</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Top Clients Section -->
  <div class="bg-white rounded-lg border border-gray-200 p-6" *ngIf="stats && stats.topClients.length > 0">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-gray-900">Clientes Más Activos</h3>
      <mat-icon class="text-gray-400">people</mat-icon>
    </div>
    
    <div class="space-y-3">
      <div
        *ngFor="let client of stats.topClients.slice(0, 5); let i = index"
        class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200">
        
        <div class="flex items-center space-x-3">
          <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">
            {{ i + 1 }}
          </div>
          <div>
            <p class="font-medium text-gray-900">{{ client.clientName }}</p>
            <p class="text-sm text-gray-600">Cédula: {{ client.cedula }}</p>
          </div>
        </div>
        
        <div class="text-right">
          <p class="font-semibold text-gray-900">{{ client.totalAccesses }} accesos</p>
          <div class="flex items-center space-x-2 mt-1">
            <app-badge
              [textBadge]="client.consecutiveDays.toString() + ' días'"
              [colorBadge]="getConsecutiveDaysBadgeColor(client.consecutiveDays)">
            </app-badge>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rewards Statistics -->
  <div class="bg-white rounded-lg border border-gray-200 p-6" *ngIf="stats && stats.rewardStats">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-gray-900">Estadísticas de Recompensas</h3>
      <mat-icon class="text-yellow-500">emoji_events</mat-icon>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Rewards by Type -->
      <div>
        <h4 class="text-sm font-medium text-gray-700 mb-3">Recompensas por Tipo</h4>
        <div class="space-y-2">
          <div *ngFor="let rewardType of stats.rewardStats.rewardsByType" class="flex items-center justify-between">
            <span class="text-sm text-gray-600">{{ getRewardTypeText(rewardType.type) }}</span>
            <app-badge [textBadge]="rewardType.count.toString()" [colorBadge]="EColorBadge.INFO"></app-badge>
          </div>
        </div>
      </div>
      
      <!-- Top Reward Earners -->
      <div>
        <h4 class="text-sm font-medium text-gray-700 mb-3">Mejores Ganadores</h4>
        <div class="space-y-2">
          <div *ngFor="let earner of stats.rewardStats.topRewardEarners.slice(0, 3)" class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-900">{{ earner.clientName }}</p>
              <p class="text-xs text-gray-500">{{ earner.cedula }}</p>
            </div>
            <app-badge [textBadge]="earner.rewardCount.toString()" [colorBadge]="EColorBadge.WARNING"></app-badge>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly/Monthly Stats (if available) -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" *ngIf="stats && (stats.weeklyStats.length > 0 || stats.monthlyStats.length > 0)">
    
    <!-- Weekly Stats -->
    <div class="bg-white rounded-lg border border-gray-200 p-6" *ngIf="stats.weeklyStats.length > 0">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Estadísticas Semanales</h3>
      <div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
        <div class="text-center">
          <mat-icon class="text-gray-400 text-4xl mb-2">show_chart</mat-icon>
          <p class="text-gray-600">Gráfico semanal</p>
          <p class="text-sm text-gray-500">{{ stats.weeklyStats.length }} semana(s) de datos</p>
        </div>
      </div>
    </div>

    <!-- Monthly Stats -->
    <div class="bg-white rounded-lg border border-gray-200 p-6" *ngIf="stats.monthlyStats.length > 0">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Estadísticas Mensuales</h3>
      <div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
        <div class="text-center">
          <mat-icon class="text-gray-400 text-4xl mb-2">timeline</mat-icon>
          <p class="text-gray-600">Gráfico mensual</p>
          <p class="text-sm text-gray-500">{{ stats.monthlyStats.length }} mes(es) de datos</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Empty State -->
<div *ngIf="!loading && !hasStatsData()" class="text-center py-12">
  <mat-icon class="text-gray-400 text-6xl mb-4">analytics</mat-icon>
  <h3 class="text-lg font-medium text-gray-900 mb-2">No hay estadísticas disponibles</h3>
  <p class="text-gray-600">{{ getEmptyStateMessage() }}</p>
</div>