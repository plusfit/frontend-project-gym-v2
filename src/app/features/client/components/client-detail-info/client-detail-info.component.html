  <div class="p-6">
    <!-- Sección: Contraseña de Usuario (Solo Administrador) - Siempre visible -->
    <div class="mb-8">
      <div class="flex items-center justify-between pb-2 border-b border-gray-200">
        <span
          class="block text-xl font-bold text-red-600"
        >
          Contraseña de Usuario
        </span>
        <div class="space-x-2">
          <button
            mat-raised-button
            color="primary"
            (click)="sendForgotPasswordEmail()"
            [disabled]="forgotPasswordLoading$ | async"
            class="ml-4"
          >
                <mat-icon>email</mat-icon>
                Recuperar Contraseña
          </button>
          <button
            mat-raised-button
            color="warn"
            (click)="togglePasswordSection()"
            class="ml-4"
          >
            <mat-icon>{{ showPasswordSection ? 'visibility_off' : 'visibility' }}</mat-icon>
            {{ showPasswordSection ? 'Ocultar' : 'Ver Contraseña' }}
          </button>
        </div>
      </div>

      @if (showPasswordSection) {
        <div class="mt-5 p-5 bg-orange-50 rounded-lg border border-orange-200">
          <div class="flex mb-4">
            <mat-icon class="text-orange-600 mr-2">warning</mat-icon>
            <span class="text-orange-700 font-semibold">Acceso Restringido - Solo Administradores</span>
          </div>
          
          <form [formGroup]="adminCodeForm" (ngSubmit)="requestPassword()" class="space-y-4">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Código de Administrador</mat-label>
              <input
                matInput
                type="password"
                formControlName="adminCode"
                placeholder="Ingrese el código de administrador"
              />
              @if (adminCodeForm.get('adminCode')?.errors?.['required']) {
                <mat-error>El código de administrador es requerido</mat-error>
              }
            </mat-form-field>

            <div class="flex space-x-3">
              <button
                mat-raised-button
                color="primary"
                type="submit"
                [disabled]="adminCodeForm.invalid || (passwordLoading$ | async)"
              >
                    <mat-icon class="mr-2">lock_open</mat-icon>
                    Obtener Contraseña
              </button>

              @if (userPassword$ | async) {
                <button
                  mat-raised-button
                  color="warn"
                  type="button"
                  (click)="clearPassword()"
                >
                  <mat-icon class="mr-2">clear</mat-icon>
                  Limpiar
                </button>
              }
            </div>
          </form>

          @if (userPassword$ | async; as password) {
            <div class="mt-5 p-4 bg-green-50 rounded-lg border border-green-200">
              <div class="flex items-center justify-between">
                <span class="text-red-600 font-semibold">Contraseña del Usuario:</span>
                <button
                  mat-icon-button
                  (click)="togglePasswordVisibility()"
                  class="text-green-600"
                >
                  <mat-icon>{{ passwordVisible ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
              </div>
              <div class="mt-2 p-3 bg-white rounded border font-mono text-lg">
                {{ passwordVisible ? password : '••••••••' }}
              </div>
              <div class="flex items-center text-xs text-green-600 mt-2">
                Esta información es confidencial y solo debe ser utilizada por administradores autorizados.
              </div>
            </div>
          }

          @if (passwordError$ | async) {
            <div class="mt-5 p-4 bg-red-50 rounded-lg border border-red-200">
              <div class="flex items-center">
                <mat-icon class="text-red-600 mr-2">error</mat-icon>
                <span class="text-red-700 font-semibold">Error al obtener la contraseña</span>
              </div>
              <p class="mt-2 text-red-600">Código de administrador incorrecto o error en el servidor.</p>
            </div>
          }
        </div>
      }

      @if (forgotPasswordSuccess$ | async) {
        <div class="mt-5 p-4 bg-green-50 rounded-lg border border-green-200">
          <div class="flex items-center">
            <mat-icon class="text-green-600 mr-2">check_circle</mat-icon>
            <span class="text-green-700 font-semibold">Email de recuperación enviado</span>
          </div>
          <p class="mt-2 text-green-600">Se ha enviado un email con instrucciones para restablecer la contraseña al usuario.</p>
        </div>
      }

      @if (forgotPasswordError$ | async) {
        <div class="mt-5 p-4 bg-red-50 rounded-lg border border-red-200">
          <div class="flex items-center">
            <mat-icon class="text-red-600 mr-2">error</mat-icon>
            <span class="text-red-700 font-semibold">Error al enviar email de recuperación</span>
          </div>
          <p class="mt-2 text-red-600">No se pudo enviar el email de recuperación. Intenta nuevamente.</p>
        </div>
      }
    </div>
@if (clientInfo$ | async; as clientInfo) {
    <!-- Resto de la información del cliente -->
    @if (clientInfo && clientInfo.name && Object.keys(clientInfo).length > 0) {
      <!-- Sección: Datos Personales -->
      <div class="mb-8">
        <span
          class="block text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-600 pb-2 border-b border-gray-200"
        >
          Datos Personales
        </span>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Nombre</span>
            <span class="text-lg font-medium text-gray-800">{{
              clientInfo.name
            }}</span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Cédula de Identidad</span>
            <span class="text-lg font-medium text-gray-800">{{
              clientInfo.CI
            }}</span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Sexo</span>
            <span class="text-lg font-medium text-gray-800">{{
              clientInfo.sex | translation
            }}</span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Día de Nacimiento</span>
            <span class="text-lg font-medium text-gray-800">{{
              clientInfo.dateBirthday | date: "dd/MM/yyyy"
            }}</span>
          </div>
        </div>
      </div>

      <!-- Sección: Información de Contacto -->
      <div class="mb-8">
        <span
          class="block text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-600 pb-2 border-b border-gray-200"
        >
          Información de Contacto
        </span>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Email</span>
            <span class="text-lg font-medium text-gray-800">{{
              clientInfo.identifier
            }}</span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Celular</span>
            <span class="text-lg font-medium text-gray-800">{{
              clientInfo.phone
            }}</span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Dirección</span>
            <span class="text-lg font-medium text-gray-800">{{
              clientInfo.address
            }}</span>
          </div>
        </div>
      </div>

      <!-- Sección: Actividad en el Gimnasio -->
      <div class="mb-8">
        <span
          class="block text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-600 pb-2 border-b border-gray-200"
        >
          Actividad en el Gimnasio
        </span>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 mt-5">
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Último Acceso</span>
            <span class="text-lg font-medium text-gray-800">
              {{ clientInfo.lastAccess ? (clientInfo.lastAccess | date: 'd/MM/yyyy, h:mm a') : 'Sin acceso registrado' }}
            </span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Total de Accesos</span>
            <div class="flex items-center space-x-3">
              <span class="text-lg font-medium text-gray-800">
                {{ clientInfo.totalAccesses || 0 }}
              </span>
            </div>
          </div>
          <div
            [ngClass]="{
              'p-5 rounded-lg shadow-sm hover:shadow-md transition-shadow border flex flex-col': true,
              'bg-green-50 border-green-100': (clientInfo.availableDays || 0) > 0,
              'bg-red-50 border-red-100': (clientInfo.availableDays || 0) === 0
            }"
          >
            <span class="text-gray-500 text-sm mb-1">Días Disponibles</span>
            <div class="flex items-center space-x-3">
              <i 
                [ngClass]="{
                  'ph-calendar-check text-xl': true,
                  'text-green-600': (clientInfo.availableDays || 0) > 0,
                  'text-red-600': (clientInfo.availableDays || 0) === 0
                }"
              ></i>
              <span 
                [ngClass]="{
                  'text-lg font-medium': true,
                  'text-gray-800': (clientInfo.availableDays || 0) > 0,
                  'text-red-700': (clientInfo.availableDays || 0) === 0
                }"
              >
                {{ clientInfo.availableDays || 0 }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Sección: Información de Salud -->
      <div class="mb-8">
        <span
          class="block text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-600 pb-2 border-b border-gray-200"
        >
          Información de Salud
        </span>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Sociedad Médica</span>
            <span class="text-lg font-medium text-gray-800">{{
              clientInfo.medicalSociety
            }}</span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1">Presión Arterial</span>
            <span class="text-lg font-medium text-gray-800">{{
              clientInfo.bloodPressure | translation
            }}</span>
          </div>
        </div>
      </div>

      <!-- Sección: Antecedentes -->
      <div class="mb-8">
        <span
          class="block text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-600 pb-2 border-b border-gray-200"
        >
          Antecedentes
        </span>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1"
              >Antecedentes Lesiones Patológicas</span
            >
            <span
              class="text-lg font-medium"
              [class.text-red-600]="
                clientInfo.historyofPathologicalLesions === 'true'
              "
              [class.text-green-600]="
                clientInfo.historyofPathologicalLesions !== 'true'
              "
            >
              {{
                clientInfo.historyofPathologicalLesions === "true" ? "Sí" : "No"
              }}
            </span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1"
              >Antecedentes Cardíacos</span
            >
            <span
              class="text-lg font-medium"
              [class.text-red-600]="clientInfo.cardiacHistory === 'true'"
              [class.text-green-600]="clientInfo.cardiacHistory !== 'true'"
            >
              {{ clientInfo.cardiacHistory === "true" ? "Sí" : "No" }}
            </span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1"
              >Antecedentes Quirúrgicos</span
            >
            <span
              class="text-lg font-medium"
              [class.text-red-600]="clientInfo.surgicalHistory === 'true'"
              [class.text-green-600]="clientInfo.surgicalHistory !== 'true'"
            >
              {{ clientInfo.surgicalHistory === "true" ? "Sí" : "No" }}
            </span>
          </div>
          <div
            class="p-5 bg-blue-50 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-blue-100 flex flex-col"
          >
            <span class="text-gray-500 text-sm mb-1"
              >Antecedentes Respiratorios</span
            >
            <span
              class="text-lg font-medium"
              [class.text-red-600]="clientInfo.respiratoryHistory === 'true'"
              [class.text-green-600]="clientInfo.respiratoryHistory !== 'true'"
            >
              {{ clientInfo.respiratoryHistory === "true" ? "Sí" : "No" }}
            </span>
          </div>
        </div>
      </div>
    } @else {
      <div class="flex justify-center items-center h-64 my-6">
        <div class="bg-blue-50 p-8 rounded-xl border border-blue-100 shadow-sm">
          <p
            class="text-xl font-bold text-gray-700 text-center flex items-center"
          >
            <i class="ph-info text-blue-500 text-2xl mr-2"></i>
            No hay información disponible para este cliente
          </p>
        </div>
      </div>
    }
} @else {
  <div class="flex justify-center items-center p-12">
    <app-loader></app-loader>
  </div>
}
